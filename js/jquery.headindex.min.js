!function(n,t){var s=((e.prototype={init:function(){if(this.articleWrap=n(this.settings.articleWrapSelector),this.headerList=this.articleWrap.find(":header"),this.indexBox=n(this.settings.indexBoxSelector),this.scrollBody=n(this.settings.scrollSelector),this.scrollWrap=n(this.settings.scrollWrap),this.manual=!1,0===this.indexBox.length||0===this.headerList.length)return null;this.initHeader(),this.event()},initHeader:function(){for(var t=0;t<this.headerList.length;t++,this.autoId++)this.headerList[t].id=this.headerList[t].id||"header-id-"+this.autoId,this.headerList[t].topHeight=this.offsetTop(this.headerList[t]),this.headerList[t].h=Number(this.headerList[t].tagName.charAt(1));this.tempHtml=[],this.buildHtml(this.buildTree());var e="<ul>"+this.tempHtml.join("")+"</ul>";this.indexBox.html(e)},event:function(){var s=this,h=null;this.indexBox.on("click.headindex",function(t){var e=n(t.target);if(e.hasClass(s.settings.linkClass)){t.preventDefault();var i=e.parent("."+s.settings.itemClass);s.manual=!0,h&&(clearTimeout(h),h=null),h=setTimeout(function(){s.manual=!1},300),s.current(i),s.scrollTo(t.target.getAttribute("href"))}}),n(this.scrollWrap).scroll(function(){s.manual||s.updateCurrent()}),s.updateCurrent()},updateTopHeight:function(){var t,e=this.headerList.length;if(0!==e&&(this.headerList[0].topHeight!==this.offsetTop(this.headerList[0])||this.headerList[e-1].topHeight!==this.offsetTop(this.headerList[e-1])))if(this.headerList[0].topHeight-this.offsetTop(this.headerList[0])!=this.headerList[e-1].topHeight-this.offsetTop(this.headerList[e-1]))for(t=0;t<this.headerList.length;t++,this.autoId++)this.headerList[t].topHeight=this.offsetTop(this.headerList[t]);else{var i=this.offsetTop(this.headerList[0])-this.headerList[0].topHeight;for(t=0;t<this.headerList.length;t++,this.autoId++)this.headerList[t].topHeight+=i}},current:function(t){var e,i="current";if(0!==t.length&&!t.hasClass(i)){var s=this.indexBox.find("li."+i);0<s.length&&s.removeClass(i),this.indexBox.find("ul.open").removeClass("open"),0<(e=t.children("."+this.settings.subItemBoxClass)).length&&e.addClass("open").slideDown();var h=t.parents("ul."+this.settings.subItemBoxClass);0<h.length&&h.addClass("open").slideDown(),0<(e=this.indexBox.find("ul."+this.settings.subItemBoxClass).not(".open")).length&&e.slideUp(),t.addClass(i)}},buildHtml:function(t){if(void 0!==t&&0!==t.length)for(var e=0;e<t.length;e++)this.tempHtml.push("<li class='"+this.settings.itemClass+"'><a class='"+this.settings.linkClass+"' href='#"+t[e].item.id+"'>"+t[e].item.innerText+"</a>"),0!==t[e].children.length&&(this.tempHtml.push("<ul class='"+this.settings.subItemBoxClass+"'>"),this.buildHtml(t[e].children),this.tempHtml.push("</ul>")),this.tempHtml.push("</li>");},buildTree:function(){for(var t,e=null,i=[],s=0;s<this.headerList.length;s++)if(null!=e)if(e.item.h<this.headerList[s].h)t={item:this.headerList[s],parent:e,children:[]},e.children.push(t),e=t;else if(e.item.h!==this.headerList[s].h){for(;null!=e&&e.item.h>this.headerList[s].h;)e=e.parent;null!=e?s--:(e={item:this.headerList[s],parent:null,children:[]},i.push(e))}else t={item:this.headerList[s],parent:e.parent,children:[]},(e.parent&&e.parent.children||i).push(t),e=t;else e={item:this.headerList[s],parent:null,children:[]},i.push(e);return i},search:function(t,e,i){if(0===this.headerList.length)return null;if(e-t<=1)return this.headerList[e].topHeight<i?this.headerList[e]:this.headerList[t];if(t<e){var s=parseInt((t+e)/2),h=this.headerList[s].topHeight;if(i<h)e=s;else{if(!(h<i))return this.headerList[s];t=s}return this.search(t,e,i)}},offsetTop:function(t){var e=this.articleWrap[0].getBoundingClientRect().top,i=t.getBoundingClientRect().top,s=376+parseInt(n(".mdui-appbar").css("height"));return parseInt(i-e+s)},scrollTo:function(t){this.scrollBody.stop().animate({scrollTop:this.offsetTop(document.querySelector(t))},"fast")},updateCurrent:function(){var t=this.scrollBody.scrollTop();this.updateTopHeight();var e=this.search(0,this.headerList.length-1,t);if(e){var i=this.indexBox.find('a[href="#'+e.id+'"]').parent("li."+this.settings.itemClass);this.current(i)}},clean:function(){this.element&&this.element.data("headIndex",null)},ignoreScrollEvent:function(t){t?this.manual=!0:(this.manual=!1,this.updateCurrent())}}).autoId=1,e);function e(t,e){this.settings=n.extend(!0,n.fn.headIndex.default,e||{}),this.element=t,this.init()}n.fn.headIndex=function(i){return this.each(function(){var t=n(this),e=t.data("headIndex");if(e||(e=new s(t,i),t.data("headIndex",e)),"string"===n.type(i))return e[i]()})},n.fn.headIndex.default={articleWrapSelector:".article-wrap",indexBoxSelector:".index-box",scrollSelector:"body,html",scrollWrap:t,subItemBoxClass:"index-subItem-box",itemClass:"index-item",linkClass:"index-link",offset:0}}(jQuery,window);